<!DOCTYPE html>
<html>

<head>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.85.2/dist/phaser-arcade-physics.min.js"></script>
</head>

<body>

    <script>
        class Example extends Phaser.Scene {
            preload() {
                this.load.setBaseURL('http://127.0.0.1:8000');
                this.load.tilemapTiledJSON('map', 'assets/map.tmx');
            }

            create() {
                // Create the tilemap using the loaded TMX
                const map = this.make.tilemap({ key: 'map' });
                //
                // // We assume that the tileset used in LDtk is named 'tilesetNameInLDtk'
                // const tileset = map.addTilesetImage('tilesetNameInLDtk', 'tiles');
                //
                // // Create layers as per the names in LDtk
                // const layer = map.createLayer('LayerNameInLDtk', tileset, 0, 0);

                // var init_x = 0;
                // async function fetchInitialState() {
                //     const response = await fetch('http://127.0.0.1:8000/state');
                //     const data = await response.json();
                //     console.log(data.state);
                //     init_x = data.state; // init_x 的值可以通过获取的 state 数据进行修改
                // }
                //
                // fetchInitialState().then(() => {
                //     this.a = this.add.image(init_x, 300, 'sky');
                // });
                //
                // this.b = this.add.image(500, 300, 'sky');
                // const socket = new WebSocket('ws://127.0.0.1:8000/ws');
                //
                // socket.onopen = function () {
                //     console.log('WebSocket connection opened.');
                // };
                //
                // socket.onmessage = function (event) {
                //     this.a.x = event.data;
                // }.bind(this);
                //
                // socket.onclose = function () {
                //     console.log('WebSocket connection closed.');
                // };
                //
                // document.getElementById('sendButton').addEventListener('click', function () {
                //     const numberInput = document.getElementById('numberInput').value;
                //     if (socket.readyState === WebSocket.OPEN) {
                //         socket.send(numberInput);
                //         console.log('Sent number:', numberInput);
                //     } else {
                //         console.log('WebSocket is not open.');
                //     }
                // });
            }

            update() {

            };
        }

        const config = {
            type: Phaser.AUTO,
            width: 800,
            height: 600,
            scene: Example,
            physics: {
                default: 'arcade',
                arcade: {
                    gravity: { y: 200 }
                }
            }
        };

        const game = new Phaser.Game(config);
    </script>

</body>

</html>